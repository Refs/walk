var Walk=function(e){"use strict";var t=function(e){throw"No associated class found for key: '"+e+"'."},r=function(e){throw e+" not implemented yet but will be soon!"},n=function(){throw"The object violates the loop tolerance. Override 'loopTolerance' in the config to allow parsing different object structures."},a=function(){throw"walk:stopProcess"},o=function(e){throw e},i=function(e,t,r,n,a,o,i){this.rel={children:[],parents:[],neighbors:[]},this.id=e,this.key=t,this.val=r,this.type=n,this.className=a,this.path=o,this.container=i,this.executedCallbacks=[]};i.prototype.encountered=1,i.prototype.isRoot=function(){return this.rel.parents.length<=0},i.prototype.filterEdges=function(e,t){var r,n=[];if("children"===e?r=this.rel.children:"parents"===e?r=this.rel.parents:"neighbors"===e&&(r=this.rel.neighbors),"undefined"==typeof t)return r;for(var a=0;a<r.length;++a){var o=!0;for(var i in t)if(r[a][i]!==t[i]){o=!1;break}o&&n.push(r[a])}return n},i.prototype.parents=function(e){return this.filterEdges("parents",e)},i.prototype.parent=function(){return 1===this.rel.parents.length?this.rel.parents[0]:void 0},i.prototype.children=function(e){return this.filterEdges("children",e)},i.prototype.neighbors=function(e){return this.filterEdges("neighbors",e)},i.prototype.ancestors=function(){for(var e=[],t=this.parents();t.length>0;){var r=t.pop();if(-1===e.indexOf(r)){e.push(r);var n=r.parents();n.length>0&&(t=t.concat(n))}}return e},i.prototype.roots=function(){for(var e=[],t=[],r=this.parents().concat(this.neighbors());r;){edge=r.pop(),e.push(edge),edge.isRoot()&&t.push(edge),edgeEdges=edge.parents().concat(edge.neighbors());for(var n=0;n<edgeEdges.length;n++)-1===e.indexOf(edgeEdges[n])&&r.push(edgeEdges[n])}return t},i.prototype.siblings=function(){for(var e=this.parents(),t=[],r=0;r<e.length;++r)for(var n=e[r].children(),a=0;a<n.length;++a)n[a]!==this&&t.push(n[a]);return t},i.prototype.createEdge=function(e,t){-1===t?this.rel.parents.push(e):1===t?this.rel.children.push(e):this.rel.neighbors.push(e)},i.prototype.addParent=function(e){this.createEdge(e,-1)},i.prototype.addChild=function(e){this.createEdge(e,1)},i.prototype.addNeighbor=function(e){this.createEdge(e,0)};var s={defaultCallbackPosition:"postWalk",configDefaults:{classMap:{},logger:console,traversalMode:"depth",strictClasses:!1,rootObjectCallbacks:!0,runCallbacks:!0,monitorPerformance:!1,nodeVisitCount:1,structure:"tree",loopTolerance:0,pathFormat:function(e,t){return t?"["+e+"]":'["'+e+'"]'},callbacks:[]},__data:{reports:[],edgeIdCounter:0,idCounter:0}};return s.__NodeBuilder=function(e,r,n,a){var o,c=typeof r,l=!("undefined"==typeof r||null===r);if(o=l&&r.constructor==Array?"array":l&&r.constructor==Object?"object":"value","object"===o||"array"===o){var u=s.__checkStructure(r);if(u)return u.encountered++,u}if("undefined"==typeof n){var _=s.__runtime.config.classMap,p=!_||!s.__runtime.config.classMap[e];s.__runtime.config.strictClasses&&p&&"object"==o?t(e):p||(n=s.__runtime.config.classMap[e])}s.__runtime.config.monitorPerformance&&(s.__data.reports[s.__runtime.reportId].processed[o]+=1,"undefined"!=typeof n&&"array"!=o&&("undefined"==typeof s.__data.reports[s.__runtime.reportId].processed.classInstances[n]?s.__data.reports[s.__runtime.reportId].processed.classInstances[n]=1:s.__data.reports[s.__runtime.reportId].processed.classInstances[n]+=1));var d=++s.__data.idCounter,f=new i(d,e,r,c,n,a,o);return("array"===o||"object"===o)&&s.__runtime.nodeObjectMap.set(r,f),f},s.__sortByPriority=function(e,t){var r=e.priority,n=t.priority;return n>r?1:r>n?-1:0},s.__log=function(e,t){s.__runtime.config.log===!0&&("undefined"==typeof t&&(t=1),1===t?s.__runtime.config.logger.log.apply(console,e):2===t?"undefined"!=typeof console.group&&s.__runtime.config.logger.group.apply(console,e):3===t&&"undefined"!=typeof console.groupEnd&&s.__runtime.config.logger.groupEnd.apply(console,e))},s.__matchedCallbacks=function(e,t){var r=s.__runtime.config.runCallbacks,n=[];if(r){var a=s.__runtime.positionCallbacks[t];if("undefined"==typeof a)return[];for(var o=0;o<a.length;++o){var i=a[o];if(!("undefined"!=typeof i.containers&&-1===i.containers.indexOf(e.container)||"undefined"!=typeof i.classNames&&-1===i.classNames.indexOf(e.className))){var c="undefined"!=typeof i.keys,l="undefined"!=typeof i.classKeys;if(c||l){if("undefined"==typeof e.key)continue;if(l){var u=e.parent();if("undefined"===u)return;if("undefined"==typeof u.className||"undefined"==typeof i.classKeys[u.className]||-1===i.classKeys[u.className].indexOf(e.key))continue}else if(-1===i.keys.indexOf(e.key))continue}n.push(i)}}}return n},s.__execCallbacks=function(e,t){for(var r=0;r<e.length;++r)e[r].__walk$_has_run=!1;for(var n=0;n<e.length;++n){if(s.__runtime.config.monitorPerformance){var a=new Date;e[n].callback(t),s.__data.reports[s.__runtime.reportId].callbackProcessingTime+=new Date-a}else e[n].callback(t);e[n].__walk$_has_run=!0,t.executedCallbacks.push(e[n])}for(var o=0;o<e.length;++o)delete e[o].__walk$_has_run},s.__process=function(e,t,r){var n=e.key,a=e.val,o=e.className,i=e.path||"",c=e.parent,l=s.__NodeBuilder(n,a,o,i);if("undefined"!=typeof c&&("tree"===s.__runtime.config.structure?l.addParent(c):"graph"===s.__runtime.config.structure&&l.addNeighbor(c)),!(l.encountered>s.__runtime.config.nodeVisitCount)){var u=s.__matchedCallbacks(l,"preWalk");u&&s.__execCallbacks(u,l);var _;if("array"===l.container)for(var p=0;p<l.val.length;++p)_={key:void 0,val:l.val[p],className:l.className,path:l.path+s.__runtime.config.pathFormat(p,!0),parent:l},"breadth"===t?r.push(_):"depth"===t&&s.__process(_,"depth");else if("object"===l.container)for(var d in l.val)l.val.hasOwnProperty(d)&&(_={key:d,val:l.val[d],className:void 0,path:l.path+s.__runtime.config.pathFormat(d,!1),parent:l},"breadth"===t?r.push(_):"depth"===t&&s.__process(_,"depth"));var f=s.__matchedCallbacks(l,"postWalk");f&&s.__execCallbacks(f,l)}},s.__breadthTraverse=function(e){var t,r=[];for(__process(e,"breadth",r);r.length>0;)t=r.shift(),s.__process(t,"breadth",r)},s.__depthTraverse=function(e){s.__process(e,"depth")},s.__initializeWalk=function(e){s.__runtime={},s.__runtime.config={},s.__runtime.nodes={},s.__runtime.seenObjects=[],s.__runtime.nodeObjectMap=new WeakMap,Object.assign(s.__runtime.config,s.configDefaults),Object.assign(s.__runtime.config,e);for(var t in s.__runtime.config){var n=!1;for(var a in s.configDefaults)if(t===a){n=!0;break}n||o("'"+t+"' is not a valid configuration entry.")}"depth"!==s.__runtime.config.traversalMode&&"breadth"!==s.__runtime.config.traversalMode&&r("Traversal modes other than 'depth' and 'breadth' are"),s.__runtime.positionCallbacks={};for(var i=0;i<s.__runtime.config.callbacks.length;++i){"undefined"==typeof s.__runtime.config.callbacks[i].priority&&(s.__runtime.config.callbacks[i].priority=0),("undefined"==typeof s.__runtime.config.callbacks[i].positions||s.__runtime.config.callbacks[i].positions.length<1)&&(s.__runtime.config.callbacks[i].positions=[s.defaultCallbackPosition]);for(var c=0;c<s.__runtime.config.callbacks[i].positions.length;++c){var l=s.__runtime.config.callbacks[i].positions[c];"undefined"==typeof s.__runtime.positionCallbacks[l]&&(s.__runtime.positionCallbacks[l]=[]),s.__runtime.positionCallbacks[l].push(s.__runtime.config.callbacks[i])}}for(var a in s.__runtime.positionCallbacks)s.__runtime.positionCallbacks[a]=s.__runtime.positionCallbacks[t].sort(s.__sortByPriority)},s.__initializeReport=function(){var e=s.__data.reports.length;return s.__data.reports.push({}),s.__data.reports[e].id=e,s.__data.reports[e].startTime=new Date,s.__data.reports[e].callbackProcessingTime=0,s.__data.reports[e].processed={},s.__data.reports[e].processed.array=0,s.__data.reports[e].processed.object=0,s.__data.reports[e].processed.value=0,s.__data.reports[e].processed.classInstances={},e},s.__deconstructReport=function(e){s.__data.reports[e]&&(s.__data.reports[e].endTime=new Date,s.__data.reports[e].executionTime=s.__data.reports[e].endTime-s.__data.reports[e].startTime)},s.__deconstructWalk=function(){s.__runtime.config.monitorPerformance&&s.__data.reports[s.__runtime.reportId]&&(s.__deconstructReport(s.__runtime.reportId),s.__runtime.config.logger.log("Finished execution. Performance report below."),s.__runtime.config.logger.log(s.__data.reports[s.__runtime.reportId])),delete s.__runtime},s.__checkStructure=function(e){var t=s.__runtime.nodeObjectMap.get(e);if("undefined"!=typeof t)if(0===s.__runtime.config.loopTolerance)n();else{if(1!==s.__runtime.config.loopTolerance||-1===t.ancestors().indexOf(t))return t;n()}return!1},s.walk=function(e,t,r){try{if(s.__initializeWalk(r),s.__runtime.config.monitorPerformance){var n=s.__initializeReport();s.__runtime.reportId=n}var a={key:void 0,val:e,className:t,path:void 0};"depth"===s.__runtime.config.traversalMode?s.__depthTraverse(a):"breadth"===s.__runtime.config.traversalMode&&s.__breadthTraverse(a)}catch(o){"walk:stopProcess"!==o&&("undefined"!=typeof console.error?console.error("Error during walk(): "+o):console.log("Error during walk(): "+o))}finally{return void s.__deconstructWalk()}},s["break"]=function(){a()},s.apply=function(e,t){s.walk(e,void 0,{callbacks:[{callback:t}]})},s.find=function(e,t,r){"undefined"==typeof r&&(r=!1);var n=function(e,t){return e==t},a=function(e,t){return e===t},o=r?n:a,i=[];return s.apply(e,function(e){o(e.val,t)&&i.push(e.val)}),i},s.convert=function(e,t,r){var n;return s.walk(e,t,{rootObjectCallbacks:!0,callbacks:[{positions:["postWalk"],callback:function(t){var r=t.parent();if(r)if(t.key)r.val[t.key]=t;else for(var a=0;a<r.val.length;a++)r.val[a]===t.val&&(r.val[a]=t);else n=t,e=n}}]}),n},s.nodeMap=function(e,t){var r={};return s.walk(e,t,{rootObjectCallbacks:!0,callbacks:[{positions:["postWalk"],callback:function(e){r[e.id]=e}}]}),r},s.flatten=function(e,t,r){var n=[];return s.walk(e,void 0,{callbacks:[{keys:[t],callback:function(e){n.push(e.val)}}]}),r?s.unique(n):n},s.updateObjectViaPathString=function(e,t,r,n){for(var a=r.split(n).slice(1);a.length>1;)e=e[a.shift()];e[a.shift()]=t},s.unique=function(e){var t={};return e.filter(function(e){return t[e]?void 0:(t[e]=!0,e)})},s.deepCopy=function(e){var t={},r="7f:&*_a6a";return s.walk(e,void 0,{pathFormat:function(e,t){return r+e},rootObjectCallbacks:!1,callbacks:[{positions:["preWalk"],callback:function(e){switch(e.container){case"array":s.updateObjectViaPathString(t,[],e.path,r);break;case"object":s.updateObjectViaPathString(t,{},e.path,r);break;case"value":s.updateObjectViaPathString(t,e.val,e.path,r)}}}]}),t},s}(Walk);